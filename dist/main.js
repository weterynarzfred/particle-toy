!function(){"use strict";var t={d:function(e,i){for(var n in i)t.o(i,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:i[n]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}};!function(){t.d({},{z:function(){return S},H:function(){return b}});const e=5e3,i=[[0,-.5,.5,.1,0,0],[40,-.05,.5,-1,0,0],[180,0,-1,1,0,0],[200,.191,.027,.466,.945,.195],[340,.639,.399,.971,.365,.035]],n={damping:.02,attraction:2,repel:2,centralGravity:0,lightnessOffset:10,smudge:.7,particleCount:20,particleRadius:3,cellSize:200};window.settings=n,window.resizeCanvas=b;const a="particle-sim-settings",l={damping:{min:0,max:3,step:.01,tooltip:"Velocity damping"},attraction:{min:0,max:10,step:.1,tooltip:"Particle attraction force"},repel:{min:0,max:10,step:.1,tooltip:"Particle repulsion force during collisions"},centralGravity:{min:-100,max:100,step:.1,tooltip:"Gravity toward center of the image"},lightnessOffset:{min:-100,max:100,step:1,tooltip:"Particle lightness offset"},smudge:{min:0,max:1,step:.01,tooltip:"Trails behind particles"},particleCount:{min:1,max:5e3,step:1,tooltip:"Number of simulated particles"},particleRadius:{min:.5,max:30,step:.5,tooltip:"Particle radius"},cellSize:{min:30,max:200,step:1,tooltip:"Spatial grid cell size, larger values consider forces between particles that are further apart at the cost of performance"}};const o=document.getElementById("canvas"),r=o.getContext("2d"),c=document.getElementById("frame-time");let s,p=0,d=0;const m=new Float32Array(e),u=new Float32Array(e),h=new Float32Array(e),f=new Float32Array(e),g=new Int8Array(e),w=new Int32Array(e);!function(){!function(){const t=localStorage.getItem(a);if(t)try{const e=JSON.parse(t);Object.assign(n,e)}catch(t){}}();const t=document.getElementById("control-panel");t.innerHTML="",Object.keys(l).forEach(e=>{!function(t,e){const i=l[t],o=document.createElement("div");o.className="control";const r=document.createElement("label");r.textContent=t,r.title=i.tooltip,r.className="control-label";const c=document.createElement("input");c.type="range",c.min=i.min,c.max=i.max,c.step=i.step,c.value=n[t],c.title=i.tooltip;const s=document.createElement("input");s.type="number",s.min=i.min,s.max=i.max,s.step=i.step,s.value=n[t],s.title=i.tooltip;const p=(e,i=!1)=>{const l=Number(e);n[t]=l,c.value=l,i||(s.value=l),"cellSize"===t?b():"lightnessOffset"===t&&S(),localStorage.setItem(a,JSON.stringify(n))};c.addEventListener("input",t=>p(t.target.value)),s.addEventListener("input",t=>p(t.target.value,!0)),o.appendChild(r),o.appendChild(c),o.appendChild(s),e.appendChild(o)}(e,t)})}();const y=new Map;function v(t,e,a){const l=`${t}:${e}:${a}`;let o=y.get(l);if(o)return o;o=document.createElement("canvas");const r=2*(a+2+10);o.width=o.height=r;const c=o.getContext("2d");c.translate(r/2,r/2);const s=7*Math.sqrt(e)+n.lightnessOffset;return c.fillStyle=`hsl(${i[t][0]}, 100%, ${s}%)`,c.beginPath(),c.arc(0,0,a,0,2*Math.PI),c.fill(),y.set(l,o),o}function S(){y.clear()}function b(){o.width=window.innerWidth,o.height=window.innerHeight,r.fillStyle="rgb(20, 15, 11)",r.fillRect(0,0,o.width,o.height),p=Math.ceil(o.width/n.cellSize),d=Math.ceil(o.height/n.cellSize),s=new Int32Array(p*d)}window.addEventListener("resize",b),b();for(let t=0;t<e;t++)m[t]=Math.random()*o.width,u[t]=Math.random()*o.height,g[t]=Math.floor(Math.random()*i.length);let x=0,C=(new Date).getTime();r.fillStyle="rgb(20, 15, 11)",r.fillRect(0,0,o.width,o.height),function t(){r.fillStyle=`rgb(17, 13, 9, ${1-n.smudge})`,r.fillRect(0,0,o.width,o.height),r.globalCompositeOperation="lighter",function(){for(let t=0;t<n.particleCount;t++){const e=m[t]-o.width/2,i=u[t]-o.height/2,a=e*e+i*i+.001;a>2e3&&(h[t]-=2*n.centralGravity/a*e,f[t]-=2*n.centralGravity/a*i),h[t]/=1+n.damping,f[t]/=1+n.damping,m[t]+=h[t],u[t]+=f[t],m[t]<=n.particleRadius?(m[t]=n.particleRadius,h[t]*=-1):m[t]>=o.width-n.particleRadius&&(m[t]=o.width-n.particleRadius,h[t]*=-1),u[t]<=n.particleRadius?(u[t]=n.particleRadius,f[t]*=-1):u[t]>=o.height-n.particleRadius&&(u[t]=o.height-n.particleRadius,f[t]*=-1)}}(),function(){s.fill(-1);for(let t=0;t<n.particleCount;t++){const e=m[t]/n.cellSize|0,i=(u[t]/n.cellSize|0)*p+e;w[t]=s[i],s[i]=t}}(),function(t){for(let e=0;e<n.particleCount;e++){const i=m[e]/n.cellSize|0,a=u[e]/n.cellSize|0;for(let l=a-1;l<=a+1;l++)if(!(l<0||l>=d))for(let a=i-1;a<=i+1;a++){if(a<0||a>=p)continue;let i=s[l*p+a];for(;-1!==i;){if(i>e){const a=m[i]-m[e],l=u[i]-u[e];a*a+l*l<=n.cellSize*n.cellSize&&t(e,i,a,l)}i=w[i]}}}}((t,e,a,l)=>{const o=a*a+l*l+.001;if(o<n.particleRadius*n.particleRadius*4){const i=-n.repel/o,r=a*i,c=l*i;h[t]+=r,f[t]+=c,h[e]-=r,f[e]-=c}const r=0|g[t],c=0|g[e],s=i[r][c+1],p=i[c][r+1],d=n.attraction/o,m=d*s,u=d*p,w=a*m,y=l*m,v=a*u,S=l*u;h[t]+=w,f[t]+=y,h[e]-=v,f[e]-=S}),function(t){for(let e=0;e<n.particleCount;e++){const i=v(g[e],0|Math.min(h[e]*h[e]+f[e]*f[e],99),n.particleRadius);t.drawImage(i,m[e]-i.width/2,u[e]-i.height/2)}}(r),r.globalCompositeOperation="source-over",requestAnimationFrame(t),x>=50&&(c.textContent=((new Date).getTime()-C)/50,C=(new Date).getTime(),x=0),x++}()}()}();